<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Building a Factorâ€‘Graph Simulator for Synthetic Data</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700&family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;1,9..40,400&display=swap" rel="stylesheet">
  <link href="../../styles.css" rel="stylesheet">
  <script>
    (function(){var k='benhelyer-theme';var s;try{s=localStorage.getItem(k);}catch(e){}var d=document.documentElement;if(s==='dark'||s==='light')d.setAttribute('data-theme',s);else d.setAttribute('data-theme',window.matchMedia&&window.matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light');})();
  </script>
  <style>
    .article .back-link { margin-bottom: 1.5rem; font-size: 0.9375rem; display: inline-block; }
    .article h1 { font-family: var(--font-heading); font-weight: 700; font-size: clamp(1.75rem, 4vw, 2.25rem); letter-spacing: -0.02em; margin: 0 0 0.5rem; color: var(--text); }
    .article .meta { color: var(--text-muted); font-size: 0.9375rem; margin-bottom: 1.5rem; }
    .article .body p { margin: 0 0 1rem; color: var(--text); }
    .article .body p:last-child { margin-bottom: 0; }
    .article .body table { width: 100%; border-collapse: collapse; margin: 2rem 0; font-size: 0.875rem; }
    .article .body table th { text-align: left; padding: 0.75rem; background-color: var(--bg-secondary); color: var(--text); font-weight: 600; border-bottom: 2px solid var(--border); }
    .article .body table td { padding: 0.75rem; border-bottom: 1px solid var(--border); color: var(--text); }
    .article .body table tr:hover { background-color: var(--bg-secondary); }
    .article .body table tbody tr:last-child td { border-bottom: none; }
    .article .body pre { background-color: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; padding: 1rem; margin: 1.5rem 0; overflow-x: auto; }
    .article .body code { font-family: 'Courier New', Courier, monospace; font-size: 0.875rem; color: var(--text); }
    .article .body pre code { display: block; white-space: pre; }
    .article .body img { max-width: 100%; height: auto; margin: 1.5rem 0; border-radius: 4px; }
    @media (max-width: 768px) {
      .article .body table { font-size: 0.75rem; }
      .article .body table th,
      .article .body table td { padding: 0.5rem; }
      .article .body code { font-size: 0.75rem; }
    }
  </style>
</head>
<body>
  <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark/light mode" title="Toggle dark/light mode">
    <span id="theme-icon">&#9728;</span>
  </button>

  <div class="wrap">
    <article class="article">
      <a href="../../index.html" class="back-link">Back to home</a>
      <h1>A Closer Look at Factors</h1>
      <p class="meta">A simple example with a forest of foxes</p>
      <div class="body">
        <p>
          Suppose we begin with some finite distribution of a single variable.
          For example, we might be interested in the number of birds,
          number of rabbits, and number of foxes in a given forest. We then
          sample, say, 100 animals, and get their distributions.
        </p>
        
        <img src="animals_in_forest_species_only.png" alt="Counting Animals in the Forest - bar chart showing counts of birds (37), foxes (23), and rabbits (40)">
        
        <p>
          If we were to want to generate samples of these animals, our configuration
          would look something like the following:
        </p>

        <code><pre>
{
  "base_probabilities_finite": {
      "species": {
          "rabbit": 0.4,
          "bird": 0.4,
          "fox": 0.2
      }
  }
}
        </pre></code>

        <p>
          Suppose now we are interested in triaging their colors.
          We might then assume color is independent, and write something like this.
        </p>

        <code>
        <pre>
{
    "base_probabilities_finite": {
        "species": {
            "rabbit": 0.4,
            "bird": 0.4,
            "fox": 0.2
        },
        "color": {
            "blue": 0.1,
            "red": 0.1,
            "white": 0.2,
            "grey": 0.3,
            "orange": 0.1,
            "brown": 0.2
        }
    }
}
        </pre>
        </code>

        <p>
          Looking at the overall distribution, we get the below. So far, so good.
        </p>

        <img src="colors_of_animals_naive_overall.png" alt="Counting Colors of Animals in the Forest with a Naive Distribution - bar chart">

        <p>
          Now let's look at only foxes.
        </p>

        <img src="fox_only_colors_naive.png" alt="Counting Colors of Only Foxes in the Forest with a Naive Distribution - bar chart">

        <p>
          Something is odd. We wouldn't expect fox colors to have this distribution, at least in the same forest.
          Blue is particularly surprising, although blue foxes exist. Also, we have observed no orange colors among the foxes.
        </p>

        <p>
          The problem is clearly in our setup. We assumed that the species distribution was independent
          from the color distribution. This is where factors come in.
        </p>

        <p>
          We fix the problem by adding in a factor into our configuration, like so:
        </p>

        <code>
          <pre>
{
  "base_probabilities_finite": {
      "species": {
          "rabbit": 0.4,
          "bird": 0.4,
          "fox": 0.2
      },
      "color": {
          "blue": 0.1,
          "red": 0.1,
          "white": 0.2,
          "grey": 0.3,
          "orange": 0.1,
          "brown": 0.2
      }
  },
  "base_probabilities_distributions": {
      "age": {
          "type": "truncated_normal",
          "mean": 5,
          "std": 2,
          "lower": 0,
          "upper": 15
      }
  },
  "factors": {
      "species": {
          "color": {
              "fox": {
                  "orange": 10.0,
                  "brown": 2.0,
                  "blue": 0.001,
                  "white": 0.05
              }
          }
      }
  }
}
          </pre>
        </code>

        <p>
          For example, this factor increases the probability of seeing an orange fox by a factor of 10. 
          Similarly, it decreases the probability of seeing a blue fox by 0.001.
        </p>

        <p>
          The way to think about this is like so: suppose we draw a random animal, and it's a fox.
          Then, what are the probabilities that we will observe the animal to have a given color?
          Foxes are predominantly orange, so we increase the chances of seeing an orange fox by 10x.
          Blue foxes are rare, so we decrease those chances by 0.001x. Then, we make the draw for the color.
          It's very likely to be either orange or brown, given the above factors. And indeed, this is
          what we get when we simulate the draw.
        </p>

        <img src="fox_only_colors_factors.png" alt="Counting Colors of Only Foxes in the Forest with a Distribution Influenced by Factors - bar chart">

        <p>
          So it's clear these factors are really helpful in modeling conditional distributions.
          Note, however, that such factors are by no means elegant. You can very easiliy overshoot
          or undershoot various subsets, depending on how your factors are manipulated (particularly
          if you stack multiple factors on top of each other; more on this later). For now, though,
          hopefully it's evident how factors are useful to us in generating samples from distinct
          populations.
        </p>

      </div>
    </article>
  </div>

  <script>
    (function() {
      var STORAGE_KEY = 'benhelyer-theme';
      var html = document.documentElement;
      var btn = document.getElementById('theme-toggle');
      var icon = document.getElementById('theme-icon');

      function setTheme(mode) {
        html.setAttribute('data-theme', mode);
        if (icon) icon.textContent = mode === 'dark' ? '\u2600' : '\u263E';
        try { localStorage.setItem(STORAGE_KEY, mode); } catch (e) {}
      }

      function cycle() {
        var current = html.getAttribute('data-theme');
        if (current === 'dark') setTheme('light');
        else setTheme('dark');
      }

      (function init() {
        var saved = null;
        try { saved = localStorage.getItem(STORAGE_KEY); } catch (e) {}
        if (saved === 'dark' || saved === 'light') {
          setTheme(saved);
        } else {
          var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          setTheme(prefersDark ? 'dark' : 'light');
        }
      })();

      if (btn) btn.addEventListener('click', cycle);
    })();
  </script>
</body>
</html>
